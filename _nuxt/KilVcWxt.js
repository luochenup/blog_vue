import{m as N,l as V,b as E,k as H,h as F}from"./raXDgERY.js";import{C as q,ak as G,c as p,j as O,F as n,U as i,al as x,aa as s,X as u,L as d,ag as z,$ as f,a0 as w,Y as S,a9 as g,a4 as j,ao as K,n as U}from"./Dkj_qHQx.js";import{u as X,q as Y}from"./CS7__6sN.js";const Z={class:"moments-page"},J={class:"moments-content"},P={key:0,class:"moments-loading"},Q={key:1,class:"moments-updating"},R={key:2,class:"moments-error"},W={key:3,class:"moments-empty"},tt={key:4,class:"moments-timeline"},et={class:"moments-list"},at={class:"moment-avatar"},st={class:"avatar-circle"},ot={class:"moment-main"},nt={class:"moment-content"},it={key:0,class:"moment-text"},ct={key:1,class:"moment-image"},rt={key:2,class:"moment-video"},dt=["src"],lt={class:"moment-footer"},ut={key:0,class:"moment-tags"},vt={key:1,class:"moment-location"},mt={class:"location-text"},pt={class:"moment-date-display"},gt=["datetime"],ht=["onClick"],_t={class:"comments-header"},yt=["id"],ft=q({__name:"novel",async setup(wt){let h,k;N({title:"朋友圈生活",meta:[{name:"description",content:"记录日常生活的点点滴滴"}]}),V().setAside(["blog-stats","blog-log"]);const{data:L,error:_,pending:b,refresh:T}=([h,k]=G(()=>X("life_moments",()=>Y("novel").select("title","description","date","updated","mood","weather","location","tags","image","video","content","_path").all(),{default:()=>[],transform:c=>Array.isArray(c)?c.sort((e,o)=>{const r=new Date(e.date||e.updated||0);return new Date(o.date||o.updated||0).getTime()-r.getTime()}).map(e=>({title:e.title||"无标题",description:e.description||"",date:e.date||e.updated||new Date().toISOString(),updated:e.updated||e.date||new Date().toISOString(),mood:e.mood||"平静",weather:e.weather||"晴天",location:e.location||"未知",tags:Array.isArray(e.tags)?e.tags:["生活"],image:e.image||"",video:Array.isArray(e.video)?e.video:[],content:e.content||"",_path:e._path||`/novel/${e.title?.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,"-")||"unknown"}`})):[]})),h=await h,k(),h),y=p(()=>_.value?(console.warn("Error loading moments:",_.value),[]):L.value||[]),C=p(()=>{const c=[...y.value].sort((o,r)=>new Date(r.date).getTime()-new Date(o.date).getTime()),t=new Map;c.forEach(o=>{const a=new Date(o.date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"});t.has(a)||t.set(a,[]),t.get(a).push(o)}),t.forEach(o=>{o.sort((r,a)=>new Date(a.date).getTime()-new Date(r.date).getTime())});const e=Array.from(t.entries()).sort(([o],[r])=>{const a=new Date(o.replace(/年|月|日/g,"/"));return new Date(r.replace(/年|月|日/g,"/")).getTime()-a.getTime()});return new Map(e)}),D=p(()=>b.value?"loading":_.value?"error":y.value.length>0?"success":"empty");p(()=>{switch(D.value){case"loading":return"加载中";case"error":return"错误";case"success":return"正常";case"empty":return"无数据";default:return"未知"}}),p(()=>{switch(D.value){case"loading":return"status-loading";case"error":return"status-error";case"success":return"status-success";case"empty":return"status-empty";default:return"status-unknown"}});function A(c){const t=new Date(c);if(c.includes("T")&&c.includes(":"))return t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});const e=t.getTime()%(1440*60*1e3);let o,r;switch(e%5){case 0:o=6+e%3;break;case 1:o=9+e%3;break;case 2:o=12+e%2;break;case 3:o=14+e%4;break;case 4:o=18+e%4;break;default:o=10+e%8}return r=e%60,`${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}function B(c){return new Date(c).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}const v=O(null);function M(c){const t=m(c);v.value===t?v.value=null:(v.value=t,U(()=>{I(c)}))}function m(c){return`${c.title}-${c.date}`.replace(/[^a-z0-9-]/gi,"-")}function I(c){const t=m(c),e=`twikoo-${t}`,o=document.getElementById(e);o&&window.twikoo&&(o.innerHTML="<p>评论加载中...</p>",window.twikoo.init({envId:H().twikoo?.envId,el:`#${e}`,path:`/novel/${t}`}))}async function $(){console.log("手动刷新数据..."),await T()}return(c,t)=>{const e=E;return i(),n("div",Z,[t[10]||(t[10]=x('<div class="moments-banner" data-v-c2ce4b58><div class="banner-decoration" data-v-c2ce4b58><div class="decoration-circle circle-1" data-v-c2ce4b58></div><div class="decoration-circle circle-2" data-v-c2ce4b58></div><div class="decoration-circle circle-3" data-v-c2ce4b58></div><div class="decoration-icon icon-1" data-v-c2ce4b58><svg viewBox="0 0 24 24" fill="currentColor" data-v-c2ce4b58><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z" data-v-c2ce4b58></path></svg></div><div class="decoration-icon icon-2" data-v-c2ce4b58><svg viewBox="0 0 24 24" fill="currentColor" data-v-c2ce4b58><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" data-v-c2ce4b58></path></svg></div><div class="decoration-icon icon-3" data-v-c2ce4b58><svg viewBox="0 0 24 24" fill="currentColor" data-v-c2ce4b58><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-c2ce4b58></path></svg></div><div class="decoration-icon icon-4" data-v-c2ce4b58><svg viewBox="0 0 24 24" fill="currentColor" data-v-c2ce4b58><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" data-v-c2ce4b58></path></svg></div></div><div class="banner-content" data-v-c2ce4b58><h1 class="banner-title" data-v-c2ce4b58> 朋友圈生活 </h1><p class="banner-subtitle" data-v-c2ce4b58> 记录生活的每一个精彩瞬间 </p></div></div>',1)),s("div",J,[d(b)&&d(y).length===0?(i(),n("div",P,[...t[1]||(t[1]=[s("div",{class:"loading-spinner"},null,-1),s("div",{class:"loading-text"},"正在加载生活记录...",-1)])])):u("",!0),d(b)&&d(y).length>0?(i(),n("div",Q,[...t[2]||(t[2]=[s("div",{class:"updating-indicator"},[s("div",{class:"updating-spinner"}),s("span",{class:"updating-text"},"正在更新数据...")],-1)])])):d(_)?(i(),n("div",R,[t[3]||(t[3]=s("div",{class:"error-icon"},"⚠️",-1)),t[4]||(t[4]=s("div",{class:"error-text"},"加载失败",-1)),t[5]||(t[5]=s("div",{class:"error-hint"},"请刷新页面重试",-1)),s("button",{onClick:$,class:"error-retry-btn"},"重新加载")])):d(C).size===0?(i(),n("div",W,[...t[6]||(t[6]=[s("div",{class:"empty-icon"}," 📱 ",-1),s("div",{class:"empty-text"}," 还没有生活记录 ",-1),s("div",{class:"empty-hint"},[z(" 在 "),s("code",null,"content/novel/"),z(" 目录下创建朋友圈生活记录 ")],-1)])])):(i(),n("div",tt,[(i(!0),n(f,null,w(d(C),([o,r])=>(i(),n("div",{key:o,class:"date-group"},[s("div",et,[(i(!0),n(f,null,w(r,a=>(i(),n("article",{key:a._path,class:"moment-item"},[s("div",at,[s("div",st,[S(e,{src:"/img/avatar.png",alt:"落尘up",class:"avatar-image"})])]),s("div",ot,[t[9]||(t[9]=x('<div class="moment-header" data-v-c2ce4b58><span class="moment-author" data-v-c2ce4b58>落尘up</span><span class="author-badge" data-v-c2ce4b58><svg class="check-icon" viewBox="0 0 24 24" width="12" height="12" data-v-c2ce4b58><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" stroke="currentColor" stroke-width="2" fill="none" data-v-c2ce4b58></path></svg> 认证 </span></div>',1)),s("div",nt,[a.content?(i(),n("div",it,g(a.content),1)):u("",!0),a.image?(i(),n("div",ct,[S(e,{src:a.image,alt:a.title,loading:"lazy",class:"moment-pic"},null,8,["src","alt"])])):u("",!0),a.video&&a.video.length>0?(i(),n("div",rt,[(i(!0),n(f,null,w(a.video,l=>(i(),n("video",{key:l,src:l,controls:"",class:"moment-video-player"}," 您的浏览器不支持视频播放 ",8,dt))),128))])):u("",!0)]),s("div",lt,[a.tags&&a.tags.length>0?(i(),n("div",ut,[(i(!0),n(f,null,w(a.tags,l=>(i(),n("span",{key:l,class:"moment-tag"}," #"+g(l),1))),128))])):u("",!0),a.location?(i(),n("div",vt,[t[7]||(t[7]=s("svg",{class:"location-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),s("span",mt,g(a.location),1)])):u("",!0),s("div",pt,[s("time",{class:"moment-full-date",datetime:a.date},g(B(a.date))+" "+g(A(a.date)),9,gt)]),s("div",{class:"moment-comments",onClick:l=>M(a)},[s("div",_t,[s("div",{class:j(["comments-toggle",{active:d(v)===m(a)}])}," 💬 评论 ",2)]),d(v)===m(a)?(i(),n("div",{key:0,class:"comments-content",onClick:t[0]||(t[0]=K(()=>{},["stop"]))},[s("div",{id:`twikoo-${m(a)}`,class:"twikoo-container"},[...t[8]||(t[8]=[s("p",null,"评论加载中...",-1)])],8,yt)])):u("",!0)],8,ht)])])]))),128))])]))),128))]))])])}}}),xt=F(ft,[["__scopeId","data-v-c2ce4b58"]]);export{xt as default};
